{% extends "base.html" %}

{% block title %}Stock Alerts - Mabutsi(IMS){% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-bell"></i> Stock Alerts</h1>
</div>

<!-- Alert Summary -->
<div class="stats-grid stats-grid-2">
    <div class="stat-card stat-danger">
        <div class="stat-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="stat-details">
            <h3>{{ low_stock_products|length }}</h3>
            <p>Products with Low Stock</p>
        </div>
    </div>
</div>

<!-- Low Stock Products -->
<div class="section-header">
    <h2><i class="fas fa-exclamation-triangle"></i> Products Needing Reorder</h2>
</div>

{% if low_stock_products %}
<div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle"></i>
    <strong>Action Required:</strong> {{ low_stock_products|length }} product(s) are at or below their minimum stock level!
</div>

<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Category</th>
                <th>Current Stock</th>
                <th>Min Stock</th>
                <th>Supplier</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for product in low_stock_products %}
            <tr>
                <td><strong>{{ product[1] }}</strong></td>
                <td>
                    {% if product[4] %}
                    <span class="badge badge-info">{{ product[4] }}</span>
                    {% else %}
                    -
                    {% endif %}
                </td>
                <td>
                    {% if product[2] == 0 %}
                    <span class="badge badge-danger">{{ product[2] }} (OUT OF STOCK)</span>
                    {% elif product[2] <= product[3] %}
                    <span class="badge badge-warning">{{ product[2] }}</span>
                    {% else %}
                    {{ product[2] }}
                    {% endif %}
                </td>
                <td>{{ product[3] }}</td>
                <td>
                    {% if product[5] %}
                    <i class="fas fa-truck"></i> {{ product[5] }}
                    {% else %}
                    <span class="text-muted">No supplier assigned</span>
                    {% endif %}
                </td>
                <td>
                    {% set shortage = product[3] - product[2] %}
                    {% if shortage > 0 %}
                    <span class="text-danger">
                        <i class="fas fa-arrow-down"></i> Need {{ shortage }} more units
                    </span>
                    {% endif %}
                </td>
                <td class="actions">
                    {% if product[5] %}
                    <a href="{{ url_for('create_purchase_order') }}" class="btn btn-sm btn-primary" title="Create Purchase Order">
                        <i class="fas fa-shopping-cart"></i> Order Now
                    </a>
                    {% else %}
                    <a href="{{ url_for('edit_product', product_id=product[0]) }}" class="btn btn-sm btn-warning" title="Assign Supplier">
                        <i class="fas fa-edit"></i> Set Supplier
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-success">
    <i class="fas fa-check-circle"></i>
    <strong>All good!</strong> No products are currently below their minimum stock levels.
</div>
{% endif %}

<!-- Quick Recommendations -->
{% if low_stock_products %}
<div class="section-header">
    <h2><i class="fas fa-lightbulb"></i> Recommended Actions</h2>
</div>

<div class="recommendations-grid">
    {% for product in low_stock_products[:5] %}
    <div class="recommendation-card">
        <div class="rec-header">
            <i class="fas fa-box"></i>
            <strong>{{ product[1] }}</strong>
        </div>
        <div class="rec-body">
            <p>Current Stock: <strong>{{ product[2] }}</strong> units</p>
            <p>Recommended Order: <strong>{{ (product[3] * 2)|int }}</strong> units</p>
            {% if product[5] %}
            <p>Supplier: {{ product[5] }}</p>
            {% endif %}
        </div>
        <div class="rec-footer">
            <a href="{{ url_for('create_purchase_order') }}" class="btn btn-sm btn-primary">
                <i class="fas fa-shopping-cart"></i> Create Order
            </a>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<style>
.recommendations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.recommendation-card {
    background: white;
    border: 2px solid var(--warning-color);
    border-radius: 8px;
    padding: 20px;
}

.rec-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    color: var(--warning-color);
    font-size: 18px;
}

.rec-body {
    margin-bottom: 15px;
}

.rec-body p {
    margin: 5px 0;
    font-size: 14px;
}

.rec-footer {
    text-align: center;
}
</style>

{% endblock %}